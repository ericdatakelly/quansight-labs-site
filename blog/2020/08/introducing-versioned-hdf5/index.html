<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Introducing Versioned HDF5 | Quansight Labs</title>
<link href="../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../../rss.xml">
<link rel="canonical" href="https://labs.quansight.org/blog/2020/08/introducing-versioned-hdf5/">
<link rel="icon" href="../../../../favicon.ico" sizes="16x16">
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
   tex2jax: {
       inlineMath: [ ['$','$'], ["\\(","\\)"], ],
       displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
   },
   displayAlign: 'center', // Change this to 'center' to center equations.
   "HTML-CSS": {
       styles: {'.MathJax_Display': {"margin": 0}}
   }
});
</script><!--[if lt IE 9]><script src="../../../../assets/js/html5.js"></script><![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-163785882-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-163785882-1');
</script><link rel="stylesheet" type="text/css" href="../../../../assets/css/tipuesearch.css">
<meta name="author" content="Melissa Weber Mendonça">
<meta property="description" content="The problem of storing and manipulating large amounts of data is a challenge in
many scientific computing and industry applications. One of the standard data
models for this is HDF5,
an open technolog">
<link rel="prev" href="../designing-with-and-for-developers/" title="Designing with and for developers" type="text/html">
<link rel="next" href="../ipython-reproducible-builds/" title="IPython reproducible builds" type="text/html">
<meta property="og:site_name" content="Quansight Labs">
<meta property="og:title" content="Introducing Versioned HDF5">
<meta property="og:url" content="https://labs.quansight.org/blog/2020/08/introducing-versioned-hdf5/">
<meta property="og:description" content="The problem of storing and manipulating large amounts of data is a challenge in
many scientific computing and industry applications. One of the standard data
models for this is HDF5,
an open technolog">
<meta property="og:image" content="https://labs.quansight.org/images/QuansightLabs_logo_V2.png">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2020-08-21T08:00:00-05:00">
<meta property="article:tag" content="h5py">
<meta property="article:tag" content="HDF5">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@quansightai">
<meta property="twitter:image" content="https://labs.quansight.org/images/QuansightLabs_logo_V2.png">
<link rel="stylesheet" href="../../../../assets/css/quansightlabs.css">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-dark bg-dark
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href="https://labs.quansight.org/">
            <img src="../../../../images/QuansightLabs_logo_V1_white.png" alt="Quansight Labs" id="logo" class="d-inline-block align-top"></a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="../../../../" class="nav-link">Home</a>
                </li>
<li class="nav-item">
<a href="../../../" class="nav-link">Blog</a>
                </li>
<li class="nav-item">
<a href="../../../../team/" class="nav-link">Team</a>
                </li>
<li class="nav-item">
<a href="../../../../projects/" class="nav-link">Projects</a>
                </li>
<li class="nav-item">
<a href="../../../../about/" class="nav-link">About</a>
                </li>
<li class="nav-item">
<a href="../../../../rss.xml" class="nav-link">RSS</a>

                
            </li>
</ul>
<form class="navbar-form navbar-left" action="../../../../search" role="search">
    <div class="form-group">
        <input type="text" class="form-control" id="tipue_search_input" name="q" placeholder="Search…" autocomplete="off">
</div>
    <input type="submit" value="Local Search" style="visibility: hidden;"><!-- button type="submit" class="btn btn-default">Submit</button -->
</form>


            <ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name">
                <a href="." class="u-url">Introducing Versioned HDF5</a>
            </h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../../../authors/melissa-weber-mendonca/">Melissa Weber Mendonça</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2020-08-21T08:00:00-05:00" itemprop="datePublished" title="2020-08-21">2020-08-21</time></a>
            </p>
            

        </div>
        
        <ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../../categories/h5py/" rel="tag">h5py</a></li>
            <li><a class="tag p-category" href="../../../../categories/hdf5/" rel="tag">HDF5</a></li>
        </ul></header><div class="e-content entry-content" itemprop="articleBody text">
        <div>
<p>The problem of storing and manipulating large amounts of data is a challenge in
many scientific computing and industry applications. One of the standard data
models for this is <a href="https://support.hdfgroup.org/HDF5/whatishdf5.html">HDF5</a>,
an open technology that implements a hierarchical structure (similar to a
file-system structure) for storing large amounts of possibly heterogeneous data
within a single file. Data in an HDF5 file is organized into <em>groups</em> and
<em>datasets</em>; you can think about these as the folders and files in your local
file system, respectively. You can also optionally store metadata associated
with each item in a file, which makes this a self-describing and powerful data
storage model.</p>
<!-- TEASER_END -->

<p><img alt="Hierarchical Data Format (HDF5) Dataset (From https://www.neonscience.org/about-hdf5)" src="../../../../images/hdf5_structure4_resized.png"><em>Image: Hierarchical Data Format (HDF5) Dataset (From https://www.neonscience.org/about-hdf5)</em></p>
<p>Since reading and writing operations in these large data files must be fast,
the HDF5 model includes data compression and <em>chunking</em>. This technique allows
the data to be retrieved in subsets that fit the computer's memory or RAM,
which means that it doesn't require the entire file contents to be loaded into
memory at once. All this makes HDF5 a popular format in several domains, and
with <a href="https://www.h5py.org">h5py</a> it is possible to use a Pythonic interface to
read and write data to a HDF5 file.</p>
<p>Now, let's say you have an HDF5 file with contents that change over time. You
may want to add or remove datasets, change the contents of the data or the
metadata, and keep a record of which changes occurred when, with a way to
recover previous versions of this file. Since HDF5 is a binary file format,
using regular version control tools (such as git) may prove difficult.</p>
<h3>Introducing the Versioned HDF5 library</h3>
<p>The Versioned HDF5 library is a versioned abstraction on top of h5py. Because
of the flexibility of the HDF5 data model, all versioning data is stored in the
file itself, which means that different versions of the same data (including
version metadata) can be stored in a single HDF5 file.</p>
<p>To see how this works in practice, let's say we create a regular HDF5 file with
h5py called <code>mydata.h5</code>.</p>
<pre class="code literal-block"><span></span><code>    <span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">h5py</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">fileobject</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s1">'mydata.h5'</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span>
</code></pre>


<p>Now, you can create a <code>VersionedHDF5file</code> object:</p>
<pre class="code literal-block"><span></span><code>    <span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">versioned_hdf5</span> <span class="kn">import</span> <span class="n">VersionedHDF5File</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">versioned_file</span> <span class="o">=</span> <span class="n">VersionedHDF5File</span><span class="p">(</span><span class="n">fileobject</span><span class="p">)</span>
</code></pre>


<p>This file still doesn't have any data or versions stored in it. To create a new
version, you can use a context manager:</p>
<pre class="code literal-block"><span></span><code>    <span class="o">&gt;&gt;&gt;</span> <span class="k">with</span> <span class="n">versioned_file</span><span class="o">.</span><span class="n">stage_version</span><span class="p">(</span><span class="s1">'version1'</span><span class="p">)</span> <span class="k">as</span> <span class="n">group</span><span class="p">:</span>
    <span class="o">...</span>     <span class="n">group</span><span class="p">[</span><span class="s1">'mydataset'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
</code></pre>


<p>The context manager returns a h5py group object, which should be modified
in-place to build the new version. When the context manager exits, the version
will be written to the file. From this moment on, any interaction with the
versioned groups and datasets should be done via the Versioned HDF5 API, rather
than h5py.</p>
<p>Now, the <code>versioned_file</code> object can be used to expose versioned data by version name:</p>
<pre class="code literal-block"><span></span><code>    <span class="o">&gt;&gt;&gt;</span> <span class="n">v1</span> <span class="o">=</span> <span class="n">versioned_file</span><span class="p">[</span><span class="s1">'version1'</span><span class="p">]</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">v1</span>
    <span class="o">&lt;</span><span class="n">Committed</span> <span class="n">InMemoryGroup</span> <span class="s2">"/_version_data/versions/version1"</span><span class="o">&gt;</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">v1</span><span class="p">[</span><span class="s1">'mydataset'</span><span class="p">]</span>
    <span class="o">&lt;</span><span class="n">InMemoryArrayDataset</span> <span class="s2">"mydataset"</span><span class="p">:</span> <span class="n">shape</span> <span class="p">(</span><span class="mi">10000</span><span class="p">,),</span> <span class="nb">type</span> <span class="s2">"&lt;f8"</span><span class="o">&gt;</span>
</code></pre>


<p>To access the actual data stored in version <code>version1</code>, we use the same syntax
as h5py:</p>
<pre class="code literal-block"><span></span><code>    <span class="o">&gt;&gt;&gt;</span> <span class="n">dataset</span> <span class="o">=</span> <span class="n">v1</span><span class="p">[</span><span class="s1">'mydataset'</span><span class="p">]</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">dataset</span><span class="p">[()]</span>
    <span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>
</code></pre>


<p>Suppose now we want to commit a new version of this data, changing just a slice
of the data. We can do this as follows:</p>
<pre class="code literal-block"><span></span><code>    <span class="o">&gt;&gt;&gt;</span> <span class="k">with</span> <span class="n">versioned_file</span><span class="o">.</span><span class="n">stage_version</span><span class="p">(</span><span class="s1">'version2'</span><span class="p">)</span> <span class="k">as</span> <span class="n">group</span><span class="p">:</span>
    <span class="o">...</span>     <span class="n">group</span><span class="p">[</span><span class="s1">'mydataset'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>
</code></pre>


<p>Both versions are now stored in the file, and can be accessed independently.</p>
<pre class="code literal-block"><span></span><code>    <span class="o">&gt;&gt;&gt;</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">versioned_file</span><span class="p">[</span><span class="s1">'version2'</span><span class="p">]</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">v1</span><span class="p">[</span><span class="s1">'mydataset'</span><span class="p">][()]</span>
    <span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">])]</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">v2</span><span class="p">[</span><span class="s1">'mydataset'</span><span class="p">][()]</span>
    <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">10.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">])]</span>
</code></pre>


<h3>Current status</h3>
<p><code>versioned-hdf5 1.0</code> has recently been released, and is available on PyPI and conda-forge. You can install it with</p>
<pre class="code literal-block"><span></span><code><span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">versioned</span><span class="o">-</span><span class="n">hdf5</span>
</code></pre>


<p>The development is on <a href="https://github.com/deshaw/versioned-hdf5">GitHub</a>.
Currently, the library supports basic use cases, but there is still a lot to
do. We welcome community contributions to the library, including any issues or
feature requests.</p>
<p>For now, you can check out the
<a href="https://deshaw.github.io/versioned-hdf5/">documentation</a> for more details on
what is supported and how the library is built.</p>
<h3>Next steps</h3>
<p>This is the first post in a series about the Versioned HDF5 library. Next,
we'll discuss the performance of Versioned HDF5 files, and the design of the
library.</p>
<p>The Versioned HDF5 library was created by the <a href="https://www.deshaw.com/">D. E. Shaw
group</a> in conjunction with
<a href="https://www.quansight.com/">Quansight</a>.</p>
<p><img alt="https://www.deshaw.com" src="../../../../images/sponsors/black_logo_417x125.png"></p>
</div>
    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../designing-with-and-for-developers/" rel="prev" title="Designing with and for developers">Previous post</a>
            </li>

            <li class="archive">
                <a href="../../../../archive.html" rel="archive" title="Archive ">Archive</a>
            </li>

            <li class="next">
                <a href="../ipython-reproducible-builds/" rel="next" title="IPython reproducible builds">Next post</a>
            </li>
        </ul></nav></aside></article><!--End of body content--><footer id="footer">
            Contents © 2021         <a href="../../../../team">Quansight Labs Team</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
            
        </footer>
</div>
</div>


        <script src="../../../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
