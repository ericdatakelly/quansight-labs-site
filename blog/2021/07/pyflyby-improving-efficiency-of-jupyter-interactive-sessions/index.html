<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Pyflyby: Improving Efficiency of Jupyter Interactive Sessions | Quansight Labs</title>
<link href="../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../../rss.xml">
<link rel="canonical" href="https://labs.quansight.org/blog/2021/07/pyflyby-improving-efficiency-of-jupyter-interactive-sessions/">
<link rel="icon" href="../../../../favicon.ico" sizes="16x16">
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
   tex2jax: {
       inlineMath: [ ['$','$'], ["\\(","\\)"], ],
       displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
   },
   displayAlign: 'center', // Change this to 'center' to center equations.
   "HTML-CSS": {
       styles: {'.MathJax_Display': {"margin": 0}}
   }
});
</script><!--[if lt IE 9]><script src="../../../../assets/js/html5.js"></script><![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-163785882-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-163785882-1');
</script><link rel="stylesheet" type="text/css" href="../../../../assets/css/tipuesearch.css">
<meta name="author" content="Matthias Bussonnier, Aaron Meurer,">
<meta property="description" content="Interruption hinder productivity more than interruption. A notification, random
realization, or unrelated error can derail one's train of thought when deep in a
complex analysis – a frustrating experi">
<link rel="prev" href="../../06/distributed-made-easy-with-ignite/" title="Distributed Training Made Easy with PyTorch-Ignite" type="text/html">
<meta property="og:site_name" content="Quansight Labs">
<meta property="og:title" content="Pyflyby: Improving Efficiency of Jupyter Interactive Sessions">
<meta property="og:url" content="https://labs.quansight.org/blog/2021/07/pyflyby-improving-efficiency-of-jupyter-interactive-sessions/">
<meta property="og:description" content="Interruption hinder productivity more than interruption. A notification, random
realization, or unrelated error can derail one's train of thought when deep in a
complex analysis – a frustrating experi">
<meta property="og:image" content="https://labs.quansight.org/images/QuansightLabs_logo_V2.png">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2021-07-07T10:00:00Z">
<meta property="article:tag" content="Deshaw">
<meta property="article:tag" content="Labs">
<meta property="article:tag" content="Pyflyby">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@quansightai">
<meta property="twitter:image" content="https://labs.quansight.org/images/QuansightLabs_logo_V2.png">
<link rel="stylesheet" href="../../../../assets/css/quansightlabs.css">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-dark bg-dark
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href="https://labs.quansight.org/">
            <img src="../../../../images/QuansightLabs_logo_V1_white.png" alt="Quansight Labs" id="logo" class="d-inline-block align-top"></a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="../../../../" class="nav-link">Home</a>
                </li>
<li class="nav-item">
<a href="../../../" class="nav-link">Blog</a>
                </li>
<li class="nav-item">
<a href="../../../../team/" class="nav-link">Team</a>
                </li>
<li class="nav-item">
<a href="../../../../projects/" class="nav-link">Projects</a>
                </li>
<li class="nav-item">
<a href="../../../../about/" class="nav-link">About</a>
                </li>
<li class="nav-item">
<a href="../../../../rss.xml" class="nav-link">RSS</a>

                
            </li>
</ul>
<form class="navbar-form navbar-left" action="../../../../search" role="search">
    <div class="form-group">
        <input type="text" class="form-control" id="tipue_search_input" name="q" placeholder="Search…" autocomplete="off">
</div>
    <input type="submit" value="Local Search" style="visibility: hidden;"><!-- button type="submit" class="btn btn-default">Submit</button -->
</form>


            <ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name">
                <a href="." class="u-url">Pyflyby: Improving Efficiency of Jupyter Interactive Sessions</a>
            </h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../../../authors/matthias-bussonnier-aaron-meurer/">Matthias Bussonnier, Aaron Meurer,</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2021-07-07T10:00:00Z" itemprop="datePublished" title="2021-07-07">2021-07-07</time></a>
            </p>
            

        </div>
        
        <ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../../categories/deshaw/" rel="tag">Deshaw</a></li>
            <li><a class="tag p-category" href="../../../../categories/labs/" rel="tag">Labs</a></li>
            <li><a class="tag p-category" href="../../../../categories/pyflyby/" rel="tag">Pyflyby</a></li>
        </ul></header><div class="e-content entry-content" itemprop="articleBody text">
        <div>
<p>Interruption hinder productivity more than interruption. A notification, random
realization, or unrelated error can derail one's train of thought when deep in a
complex analysis – a frustrating experience.</p>
<p>In the software development context, forgetting to import a statement in an
interactive Jupyter session is such an experience. This can be especially
frustrating when using typical abbreviations, like <code>np</code>, <code>pd</code>, <code>plt</code>, where the
meaning is obvious to the human reader, but not to the computer. The
time-to-first-plot, and ability to quickly cleanup one's notebook afterward
are critical to an enjoyable and efficient workflow.</p>
<p>In this blogpost we present <a href="https://github.com/deshaw/pyflyby">pyflyby</a>, a
project and an extension to IPython and
<a href="https://github.com/deshaw/jupyterlab-pyflyby">JupyterLab</a>, that, among many
things, automatically inserts imports and tidies Python files and notebooks.</p>
<!-- TEASER_END -->

<h2>What is pyflyby?</h2>
<p>Pyflyby is a set of tools designed to improve interactive and non-interactive
workflows in Python. Pyflyby provides a number of utilities and extensions aimed
at making day-to-day work in Python faster and simpler.</p>
<p><img alt="gif of pyflyby in action, IPython is opened, typing cos(arange(10))
automatically import arange and cos from numpy before executing the
code." src="../../../../images/2021/07/pfb-autoimport.gif"></p>
<h3>Autoimport</h3>
<p>One of pyflyby's key capabilities is automatic importing of commonly used
modules and objects, leading to simpler, faster, and less disruptive coding. In
a new session, for example, one can type:</p>
<pre class="code literal-block"><span></span><code><span class="n">sin</span><span class="p">(</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</code></pre>


<p>Pyflyby will then hook into the execution mechanism of Python, execute the
correct import, and confirm with a clear message:</p>
<pre class="code literal-block"><span></span><code>[PYFLYBY] from numpy import arange
[PYFLYBY] from numpy import sin
</code></pre>


<p>Pyflyby will also do so when running a command line file via
the <code>py</code> executable replacing python.</p>
<p>With the jupyterlab-pyflyby extension, imports will be executed and inserted in
the first cell of one's notebook:</p>
<p><img alt="pyflyby-jupyterlab animation, executing the second cell with missing imports
still import those and insert them in the first cell" src="../../../../images/2021/07/jlpfb.gif"></p>
<h3>tidy-import</h3>
<p>In addition to the extension that can seamlessly import the right libraries
while exploring, another pyflyby feature helps to maintain scripts and notebooks
with explicit and correct imports.</p>
<p>Pyflyby displays the <code>tidy-import</code> command line tool to gather, insert, and
format imports in Python files. This is similar to tools such as
<a href="https://pypi.org/project/black/">black</a> and
<a href="https://pypi.org/project/isort/">isort</a>, but with different styling options and
with the ability to infer missing imports.</p>
<p><code>tidy-import</code> includes the imports to pandas and matplotlib, as in the example
below, and queries whether to update the file:</p>
<pre class="code literal-block"><span></span><code>$ tidy-imports example.py
[PYFLYBY] example.py: added 'import pandas as pd'
[PYFLYBY] example.py: added 'from matplotlib import pyplot'
<span class="gd">--- example.py  2021-03-08 10:33:04.000000000 -0800</span>
<span class="gi">+++ example.py  2021-03-08 10:33:18.000000000 -0800</span>
<span class="gu">@@ -1,2 +1,7 @@</span>
<span class="gi">+from   matplotlib               import pyplot</span>
<span class="gi">+import pandas as pd</span>
<span class="gi">+</span>
 data = pd.read_csv("./data/base-pop-2015.csv")
 pyplot.plot(data.population)

Replace example.py? [y/N]
</code></pre>


<h3>Other utilities</h3>
<p>Pyflyby contains a number of other utilities to improve the efficiency of
manipulating and executing Python code. (Please refer to pyflyby's
<a href="https://github.com/deshaw/pyflyby">README</a> for additional information.)</p>
<p><code>py</code> is one such example. It is a flexible tool that can be used either to start
IPython or to execute commands quickly from the developer's shell without the
need for imports. It supports a range of syntax options, allowing for quick
calculation and graph plotting.</p>
<ul>
<li>Without any parameters, <code>py</code> will start IPython with the pyflyby extension
   activated.</li>
<li>With space-separated arguments, <code>py</code> will attempt to interpret each argument
   as a Python function call with the right imports:</li>
</ul>
<pre class="code literal-block"><span></span><code>$ py np.random.normal <span class="m">0</span> <span class="m">1</span>
<span class="o">[</span>PYFLYBY<span class="o">]</span> import numpy as np
<span class="o">[</span>PYFLYBY<span class="o">]</span> np.random.normal<span class="o">(</span><span class="m">0</span>, <span class="m">1</span><span class="o">)</span>
-0.027577422117386
</code></pre>


<ul>
<li>When more control over values is necessary, <code>py</code> will run a Python expression:</li>
</ul>
<pre class="code literal-block"><span></span><code>$ py <span class="s1">'plot(scipy.stats.norm.pdf(linspace(-5, 5), 0, 1))'</span>
<span class="o">[</span>PYFLYBY<span class="o">]</span> from numpy import linspace
<span class="o">[</span>PYFLYBY<span class="o">]</span> from matplotlib.pyplot import plot
<span class="o">[</span>PYFLYBY<span class="o">]</span> import scipy.stats
<span class="o">[</span>PYFLYBY<span class="o">]</span> plot<span class="o">(</span>scipy.stats.norm.pdf<span class="o">(</span>linspace<span class="o">(</span>-5, <span class="m">5</span><span class="o">)</span>, <span class="m">0</span>, <span class="m">1</span><span class="o">))</span>
<span class="o">[</span>&lt;matplotlib.lines.Line2D object at 0x132981940&gt;<span class="o">]</span>
</code></pre>


<p><img alt="using pyflyby from bash to plot with matplotlib with above snippet, at matplotlib widow is open and show the plot." src="../../../../images/2021/07/py-exec-matplotlib.png"></p>
<p><code>find-import</code> , another utility available in pyflyby, can be deployed to find a
particular function across many libraries by returning the relevant import.  For
example:</p>
<pre class="code literal-block"><span></span><code>$ find-import norm
from scipy.stats.distributions import norm
</code></pre>


<h2>Notes on pyflyby codebase</h2>
<p>The <a href="https://github.com/deshaw/pyflyby">Pyflyby codebase</a> provides a window into
advanced data structures and programming paradigms. Its use of modules and
programming concepts is unusual relative to those found in more classical data
science-focused libraries. For example:</p>
<ul>
<li>
<p>Pyflyby will conduct non-trivial manipulation of the Python Abstract Syntax
   Tree (AST), which represents code written in tree form. Pyflyby uses AST to
   find and insert missing imports, and it does so even as AST's exact
   representation changes with almost every minor release.</p>
</li>
<li>
<p>Pyflyby demonstrates the use of  <a href="https://en.wikipedia.org/wiki/Aspect-oriented_programming">Aspect-Oriented
   programming</a>,
   which highlights the flexibility of the Python programming model.</p>
</li>
</ul>
<h2>Conclusion</h2>
<p>Pyflyby's utilities are designed to improve developer efficiency and materially
reduce the impact of interruption on productivity. Its value, however, is
broader than that. Pyflyby expands what one is capable of doing within the Python ecosystem
and has helped identify a number of limitations and bugs in Python and IPython
over time.</p>
<h2>How to get pyflyby</h2>
<p>Pyflyby is available on <a href="https://github.com/deshaw/pyflyby">GitHub</a> or, for
terminal IPython users:</p>
<pre class="code literal-block"><span></span><code>$ pip install pyflyby
$ py pyflyby.install_in_ipython_config_file
</code></pre>


<p>JupyterLab users can also install <a href="https://github.com/deshaw/jupyterlab-pyflyby">the JupyterLab
Extension</a>, which is
notebook-aware and enables even more features.</p>
<h2>Acknowledgements</h2>
<p>Pyflyby was created by Karl Chen and is supported by the <a href="https://www.deshaw.com/">D. E. Shaw
group</a> in collaboration with <a href="https://www.quansight.com">Quansight</a>.</p>
</div>
    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../../06/distributed-made-easy-with-ignite/" rel="prev" title="Distributed Training Made Easy with PyTorch-Ignite">Previous post</a>
            </li>

            <li class="archive">
                <a href="../../../../archive.html" rel="archive" title="Archive ">Archive</a>
            </li>

            <li class="next disabled">
                <a rel="next">Next post</a>
            </li>
        </ul></nav></aside></article><!--End of body content--><footer id="footer">
            Contents © 2021         <a href="../../../../team">Quansight Labs Team</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
            
        </footer>
</div>
</div>


        <script src="../../../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
